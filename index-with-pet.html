<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é©å¿œå‹ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ã‚¿ã‚¤ãƒãƒ¼</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
const { useState, useEffect, useRef } = React;

const AdaptivePomodoro = () => {
  // åŸºæœ¬çŠ¶æ…‹
  const [currentPhase, setCurrentPhase] = useState('idle');
  const [timeLeft, setTimeLeft] = useState(0);
  const [currentWorkDuration, setCurrentWorkDuration] = useState(5);
  const [sessionCount, setSessionCount] = useState(0);
  
  // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°åˆ¶å¾¡
  const [showReasonDialog, setShowReasonDialog] = useState(false);
  const [showContinueDialog, setShowContinueDialog] = useState(false);
  const [showBreakSuggestion, setShowBreakSuggestion] = useState(false);
  const [showTaskCompleteDialog, setShowTaskCompleteDialog] = useState(false);
  
  // ã‚¿ã‚¹ã‚¯æƒ…å ±
  const [reason, setReason] = useState('');
  const [currentTaskReason, setCurrentTaskReason] = useState('');
  const [taskResult, setTaskResult] = useState('');
  const [reasonHistory, setReasonHistory] = useState([]);
  
  // çµ±è¨ˆã¨ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³
  const [totalWorkTime, setTotalWorkTime] = useState(0);
  const [totalExp, setTotalExp] = useState(0);
  const [level, setLevel] = useState(1);
  
  // ãã®ä»–ã®çŠ¶æ…‹
  const [isTimerFinished, setIsTimerFinished] = useState(false);
  const [workStartTime, setWorkStartTime] = useState(null);
    
  // ãƒšãƒƒãƒˆé–¢é€£ã®çŠ¶æ…‹
  const [petLevel, setPetLevel] = useState(1);
  const [foodCount, setFoodCount] = useState(0);
  const [petType, setPetType] = useState('egg');
    
  const intervalRef = useRef(null);
  const workDurations = [5, 6, 8, 10, 12, 15];
  
  // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰å¾©å…ƒ
  useEffect(() => {
    const saved = localStorage.getItem('pomodoroData');
    if (saved) {
      try {
        const data = JSON.parse(saved);
        setReasonHistory(data.reasonHistory || []);
        setTotalWorkTime(data.totalWorkTime || 0);
        setTotalExp(data.totalExp || 0);
        setLevel(data.level || 1);
      } catch (e) {
        console.log('ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    }
  }, []);

  // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
  const saveData = () => {
    const data = {
      reasonHistory,
      totalWorkTime,
      totalExp,
      level
    };
    localStorage.setItem('pomodoroData', JSON.stringify(data));
  };

  useEffect(() => {
    saveData();
  }, [reasonHistory, totalWorkTime, totalExp, level]);
  
  useEffect(() => {
    if (currentPhase === 'work') {
      intervalRef.current = setInterval(() => {
        setTimeLeft(prev => {
          if (prev <= 1) {
            setCurrentPhase('continue-check');
            setShowContinueDialog(true);
            setIsTimerFinished(true);
            return 0;
          }
          return prev - 1;
        });
      }, 1000);
    } else {
      if (intervalRef.current) {
        clearInterval(intervalRef.current);
      }
    }
    
    return () => {
      if (intervalRef.current) {
        clearInterval(intervalRef.current);
      }
    };
  }, [currentPhase]);

  const formatTime = (seconds) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  };

  const startWork = () => {
    setShowReasonDialog(true);
    setCurrentPhase('work');
    setTimeLeft(currentWorkDuration * 60);
    setWorkStartTime(Date.now());
  };

  const handleReasonSubmit = () => {
    if (reason.trim()) {
      setCurrentTaskReason(reason.trim());
      setReason('');
    }
    setShowReasonDialog(false);
  };

  const handleTaskComplete = () => {
    const actualWorkTime = Math.ceil((Date.now() - workStartTime) / 60000);
    const expGained = Math.ceil(actualWorkTime * 1.5);
    
    const now = new Date();
    setReasonHistory(prev => [...prev, {
      reason: currentTaskReason,
      result: taskResult.trim() || 'ä½œæ¥­å®Œäº†',
      datetime: now.toLocaleString('ja-JP'),
      plannedDuration: currentWorkDuration,
      actualDuration: actualWorkTime,
      expGained
    }]);
    
    setTotalWorkTime(prev => prev + actualWorkTime);
    setTotalExp(prev => {
      const newExp = prev + expGained;
      const newLevel = Math.floor(newExp / 100) + 1;
      setLevel(newLevel);
      return newExp;
    });
      // ã‚¨ã‚µç²å¾—å‡¦ç†
ã€€ã€€setFoodCount(prev => prev + 1);
    
    // çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
    setShowTaskCompleteDialog(false);
    setCurrentPhase('idle');
    setCurrentTaskReason('');
    setTaskResult('');
    setSessionCount(0);
    setCurrentWorkDuration(5);
    setTimeLeft(0);
    setWorkStartTime(null);
    setIsTimerFinished(false);
  };

  const handleEarlyComplete = () => {
    if (intervalRef.current) {
      clearInterval(intervalRef.current);
    }
    setCurrentPhase('task-complete');
    setShowTaskCompleteDialog(true);
  };

  const handleContinue = () => {
    setShowContinueDialog(false);
    setIsTimerFinished(false);
    setSessionCount(prev => prev + 1);
    
    const currentActualTime = Math.ceil((Date.now() - workStartTime) / 60000);
    if (currentActualTime >= 56) {
      setCurrentPhase('completed');
      return;
    }
    
    const nextSessionIndex = sessionCount + 1;
    if (nextSessionIndex < workDurations.length) {
      setCurrentWorkDuration(workDurations[nextSessionIndex]);
      setCurrentPhase('work');
      setTimeLeft(workDurations[nextSessionIndex] * 60);
    }
  };

  const handleStop = () => {
    setShowContinueDialog(false);
    setIsTimerFinished(false);
    
    if (sessionCount === 0) {
      setShowBreakSuggestion(true);
    } else {
      setShowTaskCompleteDialog(true);
    }
  };

  const handleBreakSuggestion = (action) => {
    setShowBreakSuggestion(false);
    if (action === 'retry') {
      setCurrentPhase('work');
      setTimeLeft(5 * 60);
    } else {
      setCurrentPhase('idle');
    }
  };

  const reset = () => {
    setCurrentPhase('idle');
    setTimeLeft(0);
    setCurrentWorkDuration(5);
    setSessionCount(0);
    setTotalWorkTime(0);
    setReasonHistory([]);
    setShowReasonDialog(false);
    setShowContinueDialog(false);
    setShowBreakSuggestion(false);
    setShowTaskCompleteDialog(false);
    setCurrentTaskReason('');
    setTaskResult('');
    setIsTimerFinished(false);
    setWorkStartTime(null);
    saveData();
  };

  const getPhaseDisplay = () => {
    switch(currentPhase) {
      case 'work':
        return `ä½œæ¥­ä¸­ (${currentWorkDuration}åˆ†)`;
      case 'continue-check':
        return 'ç¶™ç¶šç¢ºèª';
      case 'completed':
        return 'ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œäº†ï¼';
      default:
        return 'å¾…æ©Ÿä¸­';
    }
  };

  return React.createElement('div', {
    className: `min-h-screen bg-gray-50 py-8 px-4`
  }, 
    React.createElement('div', {
      className: `max-w-md mx-auto p-6 rounded-lg shadow-lg transition-all duration-500 ${
        isTimerFinished ? 'bg-green-100 border-4 border-green-400 animate-pulse' : 'bg-white'
      }`
    },
      React.createElement('h1', {
        className: 'text-2xl font-bold text-gray-800 mb-6 text-center'
      }, 'é©å¿œå‹ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ã‚¿ã‚¤ãƒãƒ¼'),
      
      React.createElement('div', {
        className: 'text-center mb-6'
      },
        React.createElement('div', {
          className: 'text-lg font-medium text-gray-600 mb-2'
        }, getPhaseDisplay()),
        React.createElement('div', {
          className: 'text-4xl font-mono font-bold text-gray-800'
        }, formatTime(timeLeft)),
        
        currentTaskReason && currentPhase === 'work' && React.createElement('div', {
          className: 'mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg'
        },
          React.createElement('div', {
            className: 'text-sm text-gray-600 mb-1'
          }, 'ç¾åœ¨ã®ã‚¿ã‚¹ã‚¯:'),
          React.createElement('div', {
            className: 'text-sm font-medium text-gray-800'
          }, currentTaskReason)
        )
      ),

      // ãƒ¬ãƒ™ãƒ«ã¨çµŒé¨“å€¤è¡¨ç¤º
      React.createElement('div', {
        className: 'mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg'
      },
        React.createElement('div', {
          className: 'flex justify-between items-center mb-2'
        },
          React.createElement('span', {
            className: 'text-sm font-medium text-blue-800'
          }, `Lv.${level}`),
          React.createElement('span', {
            className: 'text-sm text-blue-600'
          }, `${totalExp % 100}/100 EXP`)
        ),
        React.createElement('div', {
          className: 'w-full bg-blue-200 rounded-full h-2'
        },
          React.createElement('div', {
            className: 'bg-blue-600 h-2 rounded-full transition-all duration-300',
            style: { width: `${(totalExp % 100)}%` }
          })
        ),
        React.createElement('div', {
         className: 'text-xs text-blue-600 mt-1'
        }, `ç´¯è¨ˆä½œæ¥­æ™‚é–“: ${totalWorkTime}åˆ† | ç·çµŒé¨“å€¤: ${totalExp}`)
     ),

        // ãƒšãƒƒãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢
React.createElement('div', {
  className: 'mb-4 p-3 bg-green-50 border border-green-200 rounded-lg'
},
  React.createElement('div', {
    className: 'text-center mb-2'
  },
    React.createElement('div', {
      className: 'text-4xl mb-1'
    }, petType === 'egg' ? 'ğŸ¥š' : petType === 'cat' ? 'ğŸ±' : 'ğŸ‰'),
    React.createElement('div', {
      className: 'text-sm font-medium text-green-800'
    }, `ãƒšãƒƒãƒˆLv.${petLevel}`)
  ),
  React.createElement('div', {
    className: 'text-xs text-green-600 text-center'
  }, `ã‚¨ã‚µ: ${foodCount}å€‹`)
),

      React.createElement('div', {
        className: 'mb-6'
      },
        React.createElement('div', {
          className: 'text-sm text-gray-600 mb-2'
        }, `ã‚»ãƒƒã‚·ãƒ§ãƒ³: ${sessionCount + 1}/6`),
        React.createElement('div', {
          className: 'w-full bg-gray-200 rounded-full h-2'
        },
          React.createElement('div', {
            className: 'bg-green-600 h-2 rounded-full transition-all duration-300',
            style: { width: `${((sessionCount + 1) / 6) * 100}%` }
          })
        )
      ),

      React.createElement('div', {
        className: 'space-y-4'
      },
        currentPhase === 'work' && React.createElement('button', {
          onClick: handleEarlyComplete,
          className: 'w-full py-3 px-4 bg-green-500 text-white rounded-lg font-medium hover:bg-green-600 transition-colors mb-4'
        }, 'ã‚¿ã‚¹ã‚¯çµ‚äº†'),

        currentPhase === 'idle' && React.createElement('button', {
          onClick: startWork,
          className: 'w-full py-3 px-4 bg-red-500 text-white rounded-lg font-medium hover:bg-red-600 transition-colors'
        }, 'å«Œã ãªãƒœã‚¿ãƒ³'),

        currentPhase === 'completed' && React.createElement('div', {
          className: 'text-center'
        },
          React.createElement('p', {
            className: 'text-green-600 font-medium mb-4'
          }, 'ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼ç´„1æ™‚é–“ã®ä½œæ¥­ã‚’å®Œäº†ã—ã¾ã—ãŸã€‚'),
          React.createElement('button', {
            onClick: reset,
            className: 'py-2 px-4 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors'
          }, 'ãƒªã‚»ãƒƒãƒˆ')
        ),

        reasonHistory.length > 0 && React.createElement('div', {
          className: 'mt-6'
        },
          React.createElement('h3', {
            className: 'text-lg font-medium text-gray-800 mb-3'
          }, 'è¨˜éŒ²'),
          React.createElement('div', {
            className: 'space-y-2 max-h-40 overflow-y-auto'
          },
            reasonHistory.map((entry, index) =>
              React.createElement('div', {
                key: index,
                className: 'p-3 bg-gray-50 rounded text-sm border-l-4 border-blue-400'
              },
                React.createElement('div', {
                  className: 'font-medium text-gray-800 mb-1'
                }, entry.datetime),
                React.createElement('div', {
                  className: 'text-gray-600 mb-1'
                },
                  React.createElement('span', {
                    className: 'font-medium'
                  }, 'èª²é¡Œ: '),
                  entry.reason
                ),
                React.createElement('div', {
                  className: 'text-gray-600 mb-1'
                },
                  React.createElement('span', {
                    className: 'font-medium'
                  }, 'çµæœ: '),
                  entry.result
                ),
                React.createElement('div', {
                  className: 'flex justify-between text-xs text-gray-500'
                },
                  React.createElement('span', {}, `äºˆå®š: ${entry.plannedDuration}åˆ† / å®Ÿéš›: ${entry.actualDuration}åˆ†`),
                  React.createElement('span', {
                    className: 'text-blue-600 font-medium'
                  }, `+${entry.expGained} EXP`)
                )
              )
            )
          )
        )
      ),

      // ç†ç”±å…¥åŠ›ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
      showReasonDialog && React.createElement('div', {
        className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50'
      },
        React.createElement('div', {
          className: 'bg-white p-6 rounded-lg max-w-sm w-full'
        },
          React.createElement('h3', {
            className: 'text-lg font-medium mb-4'
          }, 'ä½•ãŒå«Œã§ã—ãŸã‹ï¼Ÿ'),
          React.createElement('textarea', {
            value: reason,
            onChange: (e) => setReason(e.target.value),
            className: 'w-full p-3 border border-gray-300 rounded-lg mb-4 resize-none',
            rows: 3,
            placeholder: 'ä¾‹ï¼šãƒ¬ãƒãƒ¼ãƒˆã‚’æ›¸ã‹ãªã‘ã‚Œã°ãªã‚‰ãªã„...'
          }),
          React.createElement('div', {
            className: 'flex space-x-2'
          },
            React.createElement('button', {
              onClick: handleReasonSubmit,
              className: 'flex-1 py-2 px-4 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors'
            }, 'é–‹å§‹')
          ),
          React.createElement('div', {
            className: 'mt-2 text-xs text-gray-500 text-center'
          }, `ã‚¿ã‚¤ãƒãƒ¼ã¯æ—¢ã«é–‹å§‹ã•ã‚Œã¦ã„ã¾ã™ (${currentWorkDuration}åˆ†)`)
        )
      ),

      // ç¶™ç¶šç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
      showContinueDialog && React.createElement('div', {
        className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50'
      },
        React.createElement('div', {
          className: 'bg-white p-6 rounded-lg max-w-sm w-full text-center'
        },
          React.createElement('h3', {
            className: 'text-lg font-medium mb-4'
          }, `${currentWorkDuration}åˆ†ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼`),
          React.createElement('div', {
            className: 'mb-6'
          },
            React.createElement('p', {
              className: 'text-sm text-gray-600 mb-2'
            }, `æ¬¡ã¯${sessionCount + 1 < workDurations.length ? workDurations[sessionCount + 1] : 15}åˆ†ã®ä½œæ¥­ã«ãªã‚Šã¾ã™`),
            React.createElement('p', {
              className: 'text-sm text-gray-600'
            }, 'ç¶šã‘ã‚‰ã‚Œãã†ã§ã™ã‹ï¼Ÿï¼ˆä¼‘æ†©ãªã—ã§å³åº§ã«é–‹å§‹ï¼‰')
          ),
          React.createElement('div', {
            className: 'flex space-x-2'
          },
            React.createElement('button', {
              onClick: handleContinue,
              className: 'flex-1 py-2 px-4 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors'
            }, 'ç¶šã‘ã‚‹'),
            React.createElement('button', {
              onClick: handleStop,
              className: 'flex-1 py-2 px-4 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors'
            }, 'çµ‚äº†')
          )
        )
      ),

      // ã‚¿ã‚¹ã‚¯åˆ†è§£ææ¡ˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°
      showBreakSuggestion && React.createElement('div', {
        className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50'
      },
        React.createElement('div', {
          className: 'bg-white p-6 rounded-lg max-w-sm w-full'
        },
          React.createElement('h3', {
            className: 'text-lg font-medium mb-4'
          }, 'ã‚¿ã‚¹ã‚¯ã‚’åˆ†è§£ã—ã¦ã¿ã¾ã—ã‚‡ã†'),
          React.createElement('div', {
            className: 'text-sm text-gray-600 mb-4'
          },
            React.createElement('p', {
              className: 'mb-2'
            }, '5åˆ†ã‚‚é›†ä¸­ã§ããªã‹ã£ãŸå ´åˆã¯ã€ã‚¿ã‚¹ã‚¯ã‚’ã‚ˆã‚Šå°ã•ãåˆ†ã‘ã‚‹ã¨è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼š'),
            React.createElement('ul', {
              className: 'list-disc list-inside space-y-1'
            },
              React.createElement('li', {}, 'è³‡æ–™ã‚’1ãƒšãƒ¼ã‚¸ã ã‘èª­ã‚€'),
              React.createElement('li', {}, 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦ã‚¿ã‚¤ãƒˆãƒ«ã ã‘æ›¸ã'),
              React.createElement('li', {}, 'é–¢é€£ã™ã‚‹é“å…·ã‚„è³‡æ–™ã‚’æœºã«ä¸¦ã¹ã‚‹'),
              React.createElement('li', {}, '5è¡Œã ã‘ãƒ¡ãƒ¢ã‚’æ›¸ã'),
              React.createElement('li', {}, '1ã¤ã®æ®µè½ã ã‘èª­ã‚€')
            )
          ),
          React.createElement('div', {
            className: 'flex space-x-2'
          },
            React.createElement('button', {
              onClick: () => handleBreakSuggestion('retry'),
              className: 'flex-1 py-2 px-4 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm'
            }, 'ã‚‚ã†ä¸€åº¦5åˆ†'),
            React.createElement('button', {
              onClick: () => handleBreakSuggestion('stop'),
              className: 'flex-1 py-2 px-4 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-sm'
            }, 'ä»Šæ—¥ã¯çµ‚äº†')
          )
        )
      ),

      // ã‚¿ã‚¹ã‚¯å®Œäº†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
      showTaskCompleteDialog && React.createElement('div', {
        className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50'
      },
        React.createElement('div', {
          className: 'bg-white p-6 rounded-lg max-w-sm w-full'
        },
          React.createElement('h3', {
            className: 'text-lg font-medium mb-4'
          }, 'ã‚¿ã‚¹ã‚¯å®Œäº†ï¼'),
          React.createElement('div', {
            className: 'mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded'
          },
            React.createElement('div', {
              className: 'text-sm text-gray-600 mb-1'
            }, 'å–ã‚Šçµ„ã‚“ã èª²é¡Œ:'),
            React.createElement('div', {
              className: 'text-sm font-medium text-gray-800'
            }, currentTaskReason)
          ),
          React.createElement('div', {
            className: 'mb-4'
          },
            React.createElement('label', {
              className: 'block text-sm font-medium text-gray-700 mb-2'
            }, 'å®Ÿéš›ã«ä½•ã‚’ã©ã“ã¾ã§ã‚„ã‚Šã¾ã—ãŸã‹ï¼Ÿ'),
            React.createElement('textarea', {
              value: taskResult,
              onChange: (e) => setTaskResult(e.target.value),
              className: 'w-full p-3 border border-gray-300 rounded-lg resize-none',
              rows: 3,
              placeholder: 'ä¾‹ï¼š7äººåˆ†ã®é€€é™¢ã‚µãƒãƒªã‚’ä½œæˆå®Œäº†'
            })
          ),
          React.createElement('div', {
            className: 'flex space-x-2'
          },
            React.createElement('button', {
              onClick: handleTaskComplete,
              className: 'flex-1 py-2 px-4 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors'
            }, 'è¨˜éŒ²ã™ã‚‹')
          )
        )
      )
    )
  );
};

ReactDOM.render(React.createElement(AdaptivePomodoro), document.getElementById('root'));
